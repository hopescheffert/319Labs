<html>
<head>
<!-- This is the websocket SERVER -->
<script src="http://localhost:5000/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

</head>
<body>
<div id="login">
	Name: <input id="username" type="text"></input>
	<button onclick="login()">Log In</button>
</div>
<div id="content" style="visibility: hidden">
	<h1>Active Users</h1>
	<div id="users"></div><br>
	<div id="newPost">
		New Post <textarea id="post" rows='2' cols='50'></textarea>
		<button id="submit" onclick="submitPost()">Submit</button>
	</div><br>
	<h1>Posts</h1>
	<div id="posts"></div>
	<button id="logout" onclick="logout()">Logout</button>
</div>
<script>
  var userName;

  function login(){
	userName = document.getElementById("username").value;
	socket.emit('login', document.getElementById("username").value);
	document.getElementById("login").style.visibility = "hidden";
	document.getElementById("content").style.visibility = "visible";
  }
  
  function submitPost(){
	socket.emit('submitPost', {post: document.getElementById("post").value, username: userName});
	document.getElementById("post").value = "";
  }
  
  function logout(){
	socket.emit('logout', userName);
	document.getElementById("login").style.visibility = "visible";
	document.getElementById("content").style.visibility = "hidden";
  }
  
  // connect to WEBSOCKET server
  var socket = io.connect('http://localhost:5000');

  socket.emit('test', 'this is a test');
  
  socket.on('updateUsers', function(users){
     var elem = document.getElementById('users');
	 elem.innerHTML="";
	 for(var i = users.length-1; i >= 0; i--){
		elem.innerHTML += "<br>" + users[i]; // append data that we got back
	 }
  });
  
  socket.on('updatePosts', function(posts){
     var elem = document.getElementById('posts'); 
	 elem.innerHTML="";
	 for(var i = posts.length-1; i >= 0; i--){
		var newPost = document.createElement("p");
		newPost.setAttribute("id", i);
		newPost.setAttribute("class", "post");
		newPost.setAttribute("title", posts[i].username);
		newPost.innerHTML = posts[i].username + " -- " + posts[i].post;
		elem.appendChild(newPost);
	 }
	 $(".post").bind("click", check)
  });
  
  function check(){
	var username = this.title;
	if(username == userName){
		var newPost = prompt("Edit your post.");
		socket.emit("editPost", {index: this.id, text: newPost});
	}
  }
  
</script>
</body>
</html>
