<html>
<head>
    <title>Drawing Board</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>


    <h1>Welcome to Drawing Board</h1>
    <p>Enter some commands to draw shapes.</p>
    <p><b>Hints:</b> <br>
        To make a circle: draw circle [id] [center of x coordinate] [center of y coordinate] [radius of circle] ;<br>
        To make a rectangle: draw rectangle [id] [width] [height] ; <br>
        To make a line: draw line [id] [start x] [start y] [end x] [end y] ; <br>
        To make an ellipse: draw ellipse [id] [center of x coordinate] [center of y coordinate] [radius of x] [radius of y] ;
    </p>

    <p><b>Note: These commands must be executed in sequence and at the same time!
        (Write all of the commands in the box and click the button once to get correct results)</b></p>

        <textarea id="commands" rows="8" cols="50">draw circle c 50 50 10;</textarea>
        <br>
        <button id="button">Do Commands!</button>
        <br>
        <script>
        $(document).ready(function()
        {
            var button = $("#button");
            var refreshed = false;

            //TODO handle refreshing?

            //AJAX call to php - send commands to parser
            button.click(function()
            {

                // if()
                // {
                //     //page was refreshed
                //     refreshed = true;
                //empty the stuff from before (for refreshing purposes)
                //$("svg").empty();
                // }


                var commands = $("#commands").val();

                $.get("ProcessCommands.php?commands=" + commands, //+ "&refreshed=" + refreshed,
                function(data)
                {
                    var count = data.split("*").length - 1;
                    //check for errors...if there are any, print them
                    if(data.includes("line "))
                    {
                        //TODO better way for error checking? maybe in the grammar file?
                        errors = data;
                        console.log(errors);
                        alert("There was an error:\n" + errors + "\nPlease fix these errors to show the correct output.");
                        // document.body.append("There was an error:\n" + errors + "\nPlease fix these errors to show the correct output.");
                    }

                    var newData = data.split("*");
                    var commandArray = [];
                    for(var i = 0; i < count; i++)
                    {
                        obj = JSON.parse(newData[i]);

                        console.log(obj);
                        commandArray.push(obj);
                    }

                    //do the commands
                    for(var c = 0; c < commandArray.length; c++)
                    {
                        id = commandArray[c].param0.replace(/\s+/g, '');


                        if(commandArray[c].command == "draw")
                        {
                            //SYNTAX: draw <shape id> [<param1>...<param4>]

                            //param0 == shape
                            if(commandArray[c].param0.startsWith("circle"))
                            {
                                d3.select("body").append("svg").attr("width", commandArray[c].param1 * 8).attr("height", commandArray[c].param2 * 8)
                                .attr("id", id)
                                .style("background-color", "#bfcdc7")

                                .append("circle")
                                .attr("cx", commandArray[c].param1)
                                .attr("cy",commandArray[c].param2)
                                .attr("r", commandArray[c].param3)
                                .style("fill", "black");
                            }
                            else if(commandArray[c].param0.startsWith("rectangle"))
                            {
                                d3.select("body").append("svg").attr("width", commandArray[c].param1 * 8).attr("height", commandArray[c].param2 * 8)
                                .attr("id", id)
                                .style("background-color", "#bfcdc7")

                                .append("rect")
                                .attr("height", commandArray[c].param1)
                                .attr("width",commandArray[c].param2)
                                .style("fill", "black");
                            }
                            else if(commandArray[c].param0.startsWith("ellipse"))
                            {
                                d3.select("body").append("svg").attr("width", commandArray[c].param1 * 8).attr("height", commandArray[c].param2 * 8)
                                .attr("id", id)
                                .style("background-color", "#bfcdc7")

                                .append("ellipse")
                                .attr("cx", commandArray[c].param1)
                                .attr("cy",commandArray[c].param2)
                                .attr("rx", commandArray[c].param3)
                                .attr("ry", commandArray[c].param4)
                                .style("fill", "black");
                            }
                            else if(commandArray[c].param0.startsWith("line"))
                            {
                                d3.select("body").append("svg").attr("width", commandArray[c].param1 * 8).attr("height", commandArray[c].param2 * 8)
                                .attr("id", id)
                                .style("background-color", "#bfcdc7")

                                .append("line")
                                .attr("x1", commandArray[c].param1)
                                .attr("y1",commandArray[c].param2)
                                .attr("x2", commandArray[c].param3)
                                .attr("y2", commandArray[c].param4)
                                .attr("stroke-width", 2)
                                .attr("stroke", "black");
                            }
                        }
                        else if(commandArray[c].command == "fill")
                        {
                            //SYNTAX: fill <shape id> <color>

                            //param0 == shape id to fill
                            //param1 == color to fill with

                            var fillSelection = d3.select("#" +id);
                            //if you cannot find the shape they are trying to fill, alert them
                            if(fillSelection._groups[0][0] == null)
                            {
                                alert("You have not made " + commandArray[c].param0 + " yet! So you cannot fill it.");
                            }
                            else
                            {
                                if(commandArray[c].param0.startsWith("rectangle"))
                                {
                                    fillSelection.select("rect")
                                    .style("fill", commandArray[c].param1);
                                }
                                else if(commandArray[c].param0.startsWith("line"))
                                {
                                    fillSelection.select("line")
                                    .style("stroke", commandArray[c].param1);
                                }
                                else if(commandArray[c].param0.startsWith("circle"))
                                {
                                    fillSelection.select("circle")
                                    .style("fill", commandArray[c].param1);
                                }
                                else if(commandArray[c].param0.startsWith("ellipse"))
                                {
                                    fillSelection.select("ellipse")
                                    .style("fill", commandArray[c].param1);
                                }
                            }
                        }
                        else if(commandArray[c].command == "rotate")
                        {
                            //SYNTAX: rotate <shape id> <degrees>
                            //param0 == shape id to rotate
                            //param1 == degrees to rotate;

                            var rotateSelection = d3.select("#" +id);
                            //if you cannot find the shape they are trying to rotate, alert them
                            if(rotateSelection._groups[0][0] == null)
                            {
                                alert("You have not made " + commandArray[c].param0 + " yet! So you cannot rotate it.");
                            }
                            else
                            {
                                if(commandArray[c].param0.startsWith("rectangle"))
                                {
                                    rotateSelection.select("rect")
                                    .attr("transform", 'rotate(' + commandArray[c].param1 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("line"))
                                {
                                    rotateSelection.select("line")
                                    .attr("transform", 'rotate(' + commandArray[c].param1 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("circle"))
                                {
                                    rotateSelection.select("circle")
                                    .attr("transform", 'rotate(' + commandArray[c].param1 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("ellipse"))
                                {
                                    rotateSelection.select("ellipse")
                                    .attr("transform", 'rotate(' + commandArray[c].param1 + ')');
                                }
                            }
                        }
                        else if(commandArray[c].command == "move")
                        {
                            var moveSelection = d3.select("#" +id);
                            //if you cannot find the shape they are trying to move, alert them
                            if(moveSelection._groups[0][0] == null)
                            {
                                alert("You have not made " + commandArray[c].param0 + " yet! So you cannot rotate it.");
                            }
                            else
                            {
                                if(commandArray[c].param0.startsWith("rectangle"))
                                {
                                    moveSelection.select("rect")
                                    .attr("transform", 'translate(' + commandArray[c].param1 + ', ' + commandArray[c].param2 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("line"))
                                {
                                    moveSelection.select("line")
                                    .attr("transform", 'translate(' + commandArray[c].param1 + ', ' + commandArray[c].param2 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("circle"))
                                {
                                    moveSelection.select("circle")
                                    .attr("transform", 'translate(' + commandArray[c].param1 + ', ' + commandArray[c].param2 + ')');
                                }
                                else if(commandArray[c].param0.startsWith("ellipse"))
                                {
                                    moveSelection.select("ellipse")
                                    .attr("transform", 'translate(' + commandArray[c].param1 + ', ' + commandArray[c].param2 + ')');
                                }
                            }

                        }
                        else if(commandArray[c].command == "grow")
                        {
                            var growSelection = d3.select("#" +id);
                            //if you cannot find the shape they are trying to grow, alert them
                            if(growSelection._groups[0][0] == null)
                            {
                                alert("You have not made " + commandArray[c].param0 + " yet! So you cannot grow it.");
                            }
                            else
                            {
                                //grow by set factor of 5
                                if(commandArray[c].param0.startsWith("rectangle"))
                                {
                                    growSelection.select("rect")
                                    .attr("transform", "scale(5)");
                                }
                                else if(commandArray[c].param0.startsWith("line"))
                                {
                                    growSelection.select("line")
                                    .attr("transform", "scale(5)");
                                }
                                else if(commandArray[c].param0.startsWith("circle"))
                                {
                                    growSelection.select("circle")
                                    .attr("transform", "scale(5)");
                                }
                                else if(commandArray[c].param0.startsWith("ellipse"))
                                {
                                    growSelection.select("ellipse")
                                    .attr("transform", "scale(5)");
                                }
                            }

                        }
                        else if(commandArray[c].command == "shrink")
                        {
                            //shrink by set factor of .3
                            var shrinkSelection = d3.select("#" +id);
                            //if you cannot find the shape they are trying to shrink, alert them
                            if(shrinkSelection._groups[0][0] == null)
                            {
                                alert("You have not made " + commandArray[c].param0 + " yet! So you cannot shrink it.");
                            }
                            else
                            {
                                if(commandArray[c].param0.startsWith("rectangle"))
                                {
                                    shrinkSelection.select("rect")
                                    .attr("transform", "scale(.3)");
                                }
                                else if(commandArray[c].param0.startsWith("line"))
                                {
                                    shrinkSelection.select("line")
                                    .attr("transform", "scale(.3)");
                                }
                                else if(commandArray[c].param0.startsWith("circle"))
                                {
                                    shrinkSelection.select("circle")
                                    .attr("transform", "scale(.3)");
                                }
                                else if(commandArray[c].param0.startsWith("ellipse"))
                                {
                                    shrinkSelection.select("ellipse")
                                    .attr("transform", "scale(.3)");
                                }
                            }
                        }
                    }

                    //https://www.dashingd3js.com/adding-an-svg-element
                    //https://www.dashingd3js.com/svg-basic-shapes-and-d3js


                });
            });

        });

        </script>



    </body>
    </html>
